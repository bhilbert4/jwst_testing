Usage
=====

Installation
------------
The test suite can be obtained by cloning the repository on GitHub `here
<https://github.com/javerbukh/ST_Validate>`_.

You can then run the test suite from within the repository via

.. code::
    
    $ python st_validate.py /path/to/my_config.cfg

Configuration Files
-------------------

All of the options for running the test suite are set via a configuration file (my_config.cfg in the above command).
For example, let's say you have some MIRI data in the directory :code:`/mydata/miri` which you have run through some of 
the steps in the calibration pipeline.  In the configuration file you would set the appropriate values to the path 
of the output file from that step, so :code:`dq_init_file` is the output after running the dq_init step.  If you skipped
some steps or don't want to test the output just set the value to :code:`None` and the tests which require output from
those steps will be skipped.

You can also specify which tests to run or skip via the :code:`tests` option.  The example below (:code:`tests = pixeldq`)
would select only tests which contain "pixeldq" in their name.  You can use any boolean expression to choose tests. For
example "pixeldq and not linearity" would choose all tests which contain "pixeldq" in their name unless they also contain
"linearity". The full list of tests and their descriptions can be found in the :doc:`test` section.

.. code::

    [dq_init]
    dq_init_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_dq.fits
    [saturation]
    sat_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_sat.fits
    [ipc]
    ipc_file = None
    [superbias]
    superbias_file = None
    [refpix]
    refpix_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_refpix.fits
    [reset]
    reset_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_reset.fits
    [lastframe]
    lastframe_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_lastframe.fits
    [linearity]
    linearity_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_lin.fits
    [dark_current]
    dark_current_file = /mydata/miri/jw06161001001_01101_00002_MIRIMAGE_dark_current.fits
    [jump]
    jump_file = None
    [ramp_fit]
    ramp_fit_file = None

    [assign_wcs]
    assign_wcs_file = None
    [flat_field]
    flat_field_file = None
    [persistence]
    persistence_file = None
    [emission]
    emission_file = None
    [photom]
    photom_file = None

    [options]
    # run tests which contain 'propagation' in their name
    tests = pixeldq

Output
------

Terminal output is generated by py.test.  You will see a list of the tests as well as whether they PASSED/FAILED/SKIPPED/ERROR.  Example output shown below

.. image:: output.png
